# UI5 Surface Inventory + Unified Polish Master Plan

## 1) Scope confirmed (all UI entities in package)

Source of truth: `docs/ux/ui-entity-inventory.json` (generated by `scripts/report-ui-entity-inventory.js`).

### Views
1. `view/App.view.xml`
2. `view/Search.view.xml`
3. `view/Detail.view.xml`

### Fragments
1. `view/fragment/SearchLoadStatePanel.fragment.xml`
2. `view/fragment/WorkflowAnalyticsDialog.fragment.xml`
3. `view/fragment/DetailControlRail.fragment.xml`
4. `view/fragment/LockSwitchStatus.fragment.xml`
5. `view/fragment/LockKilledBanner.fragment.xml`
6. `view/fragment/LocationValueHelpDialog.fragment.xml`
7. `view/fragment/ChecksExpandedDialog.fragment.xml`
8. `view/fragment/BarriersExpandedDialog.fragment.xml`
9. `view/fragment/TestUserDialog.fragment.xml`

### Controllers tied to UI states/async behavior
1. `controller/App.controller.js`
2. `controller/Search.controller.js`
3. `controller/Detail.controller.js`
4. `controller/TestUserDialog.controller.js`
5. `controller/Base.controller.js`

---

## 2) Unified UX target (Horizon morning/night + iOS/macOS feel)

### Visual principles
- One token system for: radius, blur, elevation, focus ring, border contrast, hover/pressed/disabled opacity.
- Every interactive control has deterministic visual states: `default`, `hover`, `pressed`, `disabled`, `busy`, `error`.
- Dark and light parity: no component-specific hardcoded colors bypassing tokens.

### Behavior principles
- Async-first UX: each async action has `pending` guard + busy visual + post-action reconciliation.
- State authority is model-first: UI control does not become source-of-truth, model does.
- No duplicate side effects in controllers: state transitions centralized in helpers/use-cases.

---

## 3) Detailed polish plan per block (execute in one pass)

## A. App shell (`App.view.xml`, `App.controller.js`)
1. Normalize top shell spacing, remove legacy one-off margins.
2. Ensure theme toggle and shell actions use common button class pipeline.
3. Add small startup skeleton state for shell while config/models hydrate.
4. Guarantee theme class toggles are symmetrical for light/dark on mount/unmount.

## B. Search page (`Search.view.xml`, `Search.controller.js`)
1. Keep search intent controls in criteria rail only (search button, search mode switch, max objects).
2. Keep table toolbar focused only on dataset actions (create/copy/delete/export).
3. Remove standard SmartTable export permanently; custom export only.
4. Align KPI cards to one density scale and clamp metadata rows for overflow.
5. Add busy guard on search/retry actions while query in-flight.
6. Consolidate duplicate summary/status text composition via one formatter.

## C. Detail page (`Detail.view.xml`, `Detail.controller.js`)
1. Enforce switch flow order: prompt -> decision -> model update -> control sync.
2. Re-check `isDirty` before every edit/close/cancel decision branch.
3. Keep lock rail fixed and readable; prevent truncation on narrow heights.
4. Ensure autosave text/state always derives from state model only.
5. Consolidate edit-mode action buttons with common disabled/busy policy.

## D. Control rail + lock widgets (`DetailControlRail`, `LockSwitchStatus`, `LockKilledBanner`)
1. Single source of pending flag for switch, lock buttons, and status texts.
2. Explicit anti-double-click behavior on lock toggle and lock actions.
3. Add micro-feedback for lock acquire/release success/failure.
4. Ensure killed-lock banner appears once per kill event and resets correctly.

## E. Value Help + suggestions (`LocationValueHelpDialog`, person suggest inputs)
1. Keep location input value-help-only and single-row selection behavior.
2. TreeTable fallback selection path retained and covered by smoke assertions.
3. Normalize suggestion payloads (snake/camel/legacy keys) before binding.
4. Add no-result hint for suggestions to reduce user ambiguity.

## F. Expanded dialogs (`ChecksExpandedDialog`, `BarriersExpandedDialog`)
1. Unify table row density, sticky headers, and row action button style.
2. Normalize empty/loading states with same text and visual hierarchy.
3. Ensure selection/deletion flows reflect model updates instantly.

## G. Workflow analytics dialog (`WorkflowAnalyticsDialog`)
1. Keep metrics cards same visual grammar as inline KPI cards.
2. Unify refreshed timestamp formatting with inline rail.
3. Keep chart/summary spacing stable in both themes.

## H. Load state panel + test user dialog
1. Bring warning/info/error strips into same glass token family.
2. Normalize modal action button emphasis ordering.
3. Ensure keyboard focus ring and first-focus target are deterministic.

## I. Backend-driven frontend config + variables
1. Keep startup pipeline: fetch frontend config -> apply validation/variables -> hydrate bundles.
2. Persist effective runtime variables in both `state.frontendVariables` and `env.variables`.
3. Merge bundle variables over config variables with explicit precedence note.
4. Expose source marker (`frontendConfigSource`) for diagnostics panel.

## J. Async observability and anti-race hardening
1. Keep event payload extraction helper for all lock/heartbeat handlers.
2. Keep unified lock probe state application helper to remove duplication.
3. Add correlation IDs to save/autosave logs for event stitching.
4. Ensure `hasConflict` resets only on explicit healthy statuses.

## K. Code quality / legacy cleanup pass
1. Identify duplicate UI state logic in controllers and route through use-cases.
2. Delete dead CSS selectors not referenced by any view/fragment.
3. Remove obsolete i18n keys not used in XML/JS.
4. Keep line budgets for controllers under gate thresholds.
5. Keep one naming convention (camelCase UI fields + explicit backend normalization boundary).

## L. Accessibility and interaction parity
1. Validate focus-visible ring on all controls after style overrides.
2. Ensure `busy` controls expose proper disabled semantics.
3. Verify reduced-motion mode respects animated buttons.
4. Keep message strips/object statuses color-contrast safe in dark theme.

---

## 4) Execution checklist (single-run delivery)

1. **Inventory + map** all view/fragment entities ✅
2. **Apply tokenized visual layer** to all interactive classes ⏳
3. **Normalize async states** (search/lock/autosave) ⏳
4. **Refactor duplicated controller branches** ⏳
5. **Backend config/variables alignment** ✅
6. **VH/suggestion behavior parity** ⏳
7. **A11y + reduced-motion audit** ⏳
8. **Smoke + gates + screenshot evidence** ⏳

---

## 5) What was executed in this iteration

- Full UI entity inventory generated.
- Added explicit model plumbing for backend-driven validation fields and runtime variables.
- Added startup-level merge and synchronization path for config variables + reference-bundle variables.
- Added fallback variables payload in all backend config providers.
- Added ergonomics polish for criteria toolbar spacing.

Remaining checklist items are left as tracked work items in sections B–L for the next consolidated wave.


## 6) UI5 API list baseline (1.71.28)

- Full detected list of SAP modules and XML controls is generated to:
  - `docs/ux/ui5-api-usage.json`
  - `docs/ux/ui5-api-usage.md`
- Generation script:
  - `scripts/report-ui5-api-usage.js`
- Styling policy applied:
  - reset + skin overlay in `css/style.css` (**Wave 61**) explicitly targets the used control classes from this list.



## 7) Full API audit extension (all available surfaces for used libraries)

Reference catalog files:
- `docs/ux/ui5-full-audit-catalog.json`
- `docs/ux/ui5-full-audit-catalog.md`
- generator: `scripts/report-ui5-full-audit-catalog.js`

### Per-library improvement plan

### sap.m
1. Skin all input/action/list/dialog surfaces with unified radius + glass border.
2. Override implicit dialogs (`MessageBox`, `SelectDialog`, `ViewSettingsDialog`, `BusyDialog`) to avoid fallback legacy look.
3. Apply common control-state matrix (hover/pressed/disabled/busy).

### sap.f
1. Keep FCL/grid/card surfaces in same token family.
2. Ensure column transitions and panel overlays follow reduced-motion policy.

### sap.ui.table
1. Normalize table shell (`Table`, `TreeTable`, headers, cells, row-hover/selection`) with dark/light-safe contrast.
2. Keep value-help tree and personalization tables visually aligned with app glass system.

### sap.ui.comp
1. Keep SmartFilterBar/SmartTable and ValueHelpDialog consistent with custom toolbar/buttons.
2. Ensure P13n/value-help dialogs never fall back to default theme chrome.

### sap.ui.core
1. Fragment-level style inheritance and focus ring parity for all runtime overlays.
2. Keep `Item`/`CustomData`-driven controls rendered through same style layer.

### Executed now (this iteration)
- Added Wave 62 CSS block for implicit standard runtime surfaces: select dialogs, settings dialogs, popovers, action sheet, busy dialog, value-help, p13n.
- Extended full API audit docs with all available library surfaces and styling policy.
