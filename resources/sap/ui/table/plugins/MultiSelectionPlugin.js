/*
 * OpenUI5
 * (c) Copyright 2026 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./SelectionPlugin","./PluginBase","./SelectionModelSelection","./BindingSelection","../library","../utils/TableUtils","sap/ui/core/IconPool","sap/base/Log"],function(e,t,i,n,o,l,r,s){"use strict";const c=o.SelectionMode;const a=e.extend("sap.ui.table.plugins.MultiSelectionPlugin",{metadata:{library:"sap.ui.table",properties:{limit:{type:"int",group:"Behavior",defaultValue:200},enableNotification:{type:"boolean",group:"Behavior",defaultValue:false},showHeaderSelector:{type:"boolean",group:"Appearance",defaultValue:true},selectionMode:{type:"sap.ui.table.SelectionMode",group:"Behavior",defaultValue:c.MultiToggle}},events:{selectionChange:{parameters:{indices:{type:"int[]"},limitReached:{type:"boolean"},customPayload:{type:"object"}}}}}});a.findOn=t.findOn;a.prototype.init=function(){e.prototype.init.apply(this,arguments);this._bLimitReached=false;this._bLimitDisabled=this.getLimit()===0;this.oInnerSelectionPlugin=null};a.prototype.onActivate=function(t){e.prototype.onActivate.apply(this,arguments);this.oInnerSelectionPlugin=u(t);this.oInnerSelectionPlugin.setSelectionMode(this.getSelectionMode());this.oInnerSelectionPlugin.attachSelectionChange(this._onSelectionChange,this);p(this,t.getBinding());t.addAggregation("_hiddenDependents",this.oInnerSelectionPlugin);t.setProperty("selectionMode",this.getSelectionMode());g(this);l.Hook.register(t,l.Hook.Keys.Table.RowsBound,f,this);l.Hook.register(t,l.Hook.Keys.Table.RowsUnbound,S,this)};function u(e){if(e.isA(["sap.ui.table.TreeTable","sap.ui.table.AnalyticalTable"])){return new n}else{return new i}}a.prototype.onDeactivate=function(t){e.prototype.onDeactivate.apply(this,arguments);t.setProperty("selectionMode",o.SelectionMode.None);m(this,t.getBinding());this.oInnerSelectionPlugin?.destroy();delete this.oInnerSelectionPlugin;l.Hook.deregister(t,l.Hook.Keys.Table.RowsBound,f,this);l.Hook.deregister(t,l.Hook.Keys.Table.RowsUnbound,S,this)};a.prototype.setSelected=function(e,t,i){if(!this.isIndexSelectable(e.getIndex())){return}if(i&&i.range){const t=this.getSelectedIndex();if(t>=0){this.addSelectionInterval(t,e.getIndex())}}else if(t){this.addSelectionInterval(e.getIndex(),e.getIndex())}else{this.removeSelectionInterval(e.getIndex(),e.getIndex())}};a.prototype.isSelected=function(e){return this.isIndexSelected(e.getIndex())};a.prototype.onHeaderSelectorPress=function(){const e=this._getHeaderSelector();if(!e.getVisible()||!e.getEnabled()){return}if(e.getType()==="CheckBox"){h(this)}else if(e.getType()==="Icon"){if(this.getSelectedCount()>0){this.clearSelection()}else{this.addSelectionInterval(0,this._getHighestSelectableIndex())}}};a.prototype.onKeyboardShortcut=function(e,t){if(e==="toggle"){if(this.getSelectionMode()!==c.MultiToggle){return}if(this._bLimitDisabled){if(!h(this)){t.setMarked("sapUiTableClearAll")}}else{this.addSelectionInterval(0,this._getHighestSelectableIndex())}}else if(e==="clear"){this.clearSelection();t.setMarked("sapUiTableClearAll")}};function h(e){if(e.getSelectableCount()>e.getSelectedCount()){e.selectAll();return true}else{e.clearSelection();return false}}a.prototype.setSelectionMode=function(e){this.setProperty("selectionMode",e,true);if(!this.isActive()){return this}this.getControl().setProperty("selectionMode",e);this.oInnerSelectionPlugin.setSelectionMode(e);g(this);return this};a.prototype.setLimit=function(e){if(typeof e==="number"&&e<0){s.warning("The limit must be greater than or equal to 0",this);return this}this.setProperty("limit",e,!!this.getLimit()===!!e);this._bLimitDisabled=e===0;g(this);return this};a.prototype.setEnableNotification=function(e){this.setProperty("enableNotification",e,true);return this};a.prototype.setShowHeaderSelector=function(e){this.setProperty("showHeaderSelector",e,true);g(this);return this};a.prototype.isLimitReached=function(){return this._bLimitReached};a.prototype.setLimitReached=function(e){this._bLimitReached=e};a.prototype.selectAll=function(e){if(!this.isActive()){return Promise.reject(new Error("Plugin is disabled"))}if(!this._bLimitDisabled){return Promise.reject(new Error("Not possible if the limit is enabled"))}const t=this.getSelectableCount();if(t===0){return Promise.reject(new Error("Nothing to select"))}return this.addSelectionInterval(0,this._getHighestSelectableIndex(),e)};function d(e,t,i,n){const o=e._getHighestSelectableIndex();if(t<0&&i<0||t>o&&i>o){return Promise.reject(new Error("Out of range"))}t=Math.min(Math.max(0,t),o);i=Math.min(Math.max(0,i),o);const r=e.getLimit();const s=i<t;let c=s?i:t;let a;if(n&&e.isIndexSelected(t)){if(s){t--}else if(t!==i){t++;c++}}a=Math.abs(i-t)+1;if(!e._bLimitDisabled){e.setLimitReached(a>r);if(e.isLimitReached()){if(s){i=t-r+1;c=i-1}else{i=t+r-1}a=r+1}}return l.loadContexts(e.getControl().getBinding(),c,a).then(function(n){if(!e._bLimitDisabled&&n.length<r){e.setLimitReached(false);if(s){i=t-n.length+1}else{i=t+n.length-1}}return{indexFrom:t,indexTo:i}})}a.prototype.setSelectionInterval=function(e,t,i){const n=this.getControl();const o=this.getSelectionMode();if(!this.isActive()){return Promise.reject(new Error("Plugin is disabled"))}if(o===c.None){return Promise.reject(new Error("SelectionMode is '"+c.None+"'"))}if(o===c.Single){e=t}return d(this,e,t,false).then(function(e){this._oCustomEventPayloadTmp=i;this.oInnerSelectionPlugin.setSelectionInterval(e.indexFrom,e.indexTo);delete this._oCustomEventPayloadTmp;if(!this.isLimitReached()){return Promise.resolve()}return l.scrollTableToIndex(n,e.indexTo,e.indexFrom>e.indexTo).then(function(){if(!this.getEnableNotification()){return Promise.resolve()}return l.showNotificationPopoverAtIndex(n,e.indexTo,this.getLimit())}.bind(this))}.bind(this))};a.prototype.setSelectedIndex=function(e,t){return this.setSelectionInterval(e,e,t)};a.prototype.addSelectionInterval=function(e,t,i){const n=this.getControl();const o=this.getSelectionMode();if(!this.isActive()){return Promise.reject(new Error("Plugin is disabled"))}if(o===c.None){return Promise.reject(new Error("SelectionMode is '"+c.None+"'"))}if(o===c.Single){return this.setSelectionInterval(t,t)}if(o===c.MultiToggle){return d(this,e,t,true).then(function(e){this._oCustomEventPayloadTmp=i;this.oInnerSelectionPlugin.addSelectionInterval(e.indexFrom,e.indexTo);delete this._oCustomEventPayloadTmp;if(!this.isLimitReached()){return Promise.resolve()}return l.scrollTableToIndex(n,e.indexTo,e.indexFrom>e.indexTo).then(function(){if(!this.getEnableNotification()){return Promise.resolve()}return l.showNotificationPopoverAtIndex(n,e.indexTo,this.getLimit())}.bind(this))}.bind(this))}};a.prototype.clearSelection=function(e){if(this.oInnerSelectionPlugin){this.setLimitReached(false);this._oCustomEventPayloadTmp=e;this.oInnerSelectionPlugin.clearSelection();delete this._oCustomEventPayloadTmp}};a.prototype.getSelectedIndex=function(){if(this.oInnerSelectionPlugin){return this.oInnerSelectionPlugin.getSelectedIndex()}return-1};a.prototype.getSelectedIndices=function(){if(this.oInnerSelectionPlugin){return this.oInnerSelectionPlugin.getSelectedIndices()}return[]};a.prototype.getSelectableCount=function(){if(this.oInnerSelectionPlugin){return this.oInnerSelectionPlugin.getSelectableCount()}return 0};a.prototype.getSelectedCount=function(){if(this.oInnerSelectionPlugin){return this.oInnerSelectionPlugin.getSelectedCount()}return 0};a.prototype.isIndexSelectable=function(e){if(this.oInnerSelectionPlugin){return this.oInnerSelectionPlugin.isIndexSelectable(e)}return false};a.prototype.isIndexSelected=function(e){if(this.oInnerSelectionPlugin){return this.oInnerSelectionPlugin.isIndexSelected(e)}return false};a.prototype.removeSelectionInterval=function(e,t,i){if(this.oInnerSelectionPlugin){this.setLimitReached(false);this._oCustomEventPayloadTmp=i;this.oInnerSelectionPlugin.removeSelectionInterval(e,t);delete this._oCustomEventPayloadTmp}};function g(e){const t=e._getHeaderSelector();if(!e.isActive()||!t){return}const i=e.getSelectionMode()===c.MultiToggle&&e.getShowHeaderSelector();const n=e._bLimitDisabled?"CheckBox":"Icon";const o=e.getSelectableCount()>0;const s=e.getSelectableCount()>0&&e.getSelectableCount()===e.getSelectedCount();let a=null;if(n==="Icon"){if(e.getSelectedCount()===0){a=l.getResourceText("TBL_SELECT_ALL")}else{a=l.getResourceText("TBL_DESELECT_ALL")}}let u="";if(e.getSelectionMode()===c.MultiToggle&&!e._bLimitDisabled){const t=e.getSelectedCount();if(e.getSelectableCount()===t&&t!==0){u=r.getIconURI(l.ThemeParameters.allSelectedIcon)}else if(t!==0){u=r.getIconURI(l.ThemeParameters.clearSelectionIcon)}else{u=r.getIconURI(l.ThemeParameters.checkboxIcon)}}t.setVisible(i);t.setType(n);t.setEnabled(o);t.setCheckBoxSelected(s);t.setIcon(u);t.setTooltip(a)}a.prototype._onSelectionChange=function(e){const t=e.getParameter("rowIndices");g(this);this.fireSelectionChange({rowIndices:t,limitReached:this.isLimitReached(),customPayload:typeof this._oCustomEventPayloadTmp==="object"?this._oCustomEventPayloadTmp:null,_internalTrigger:e.getParameter("_internalTrigger")})};a.prototype._getHighestSelectableIndex=function(){if(this.oInnerSelectionPlugin){return this.oInnerSelectionPlugin._getHighestSelectableIndex()}return 0};function f(e){p(this,e);g(this)}function S(){g(this)}function p(e,t){t?.attachChange(I,e)}function m(e,t){t?.detachChange(I,e)}function I(e){g(this)}a.prototype.onThemeChanged=function(){g(this)};return a});
//# sourceMappingURL=MultiSelectionPlugin.js.map