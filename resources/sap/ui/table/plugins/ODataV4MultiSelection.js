/*
 * OpenUI5
 * (c) Copyright 2026 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./ODataV4Selection","./PluginBase","../utils/TableUtils","../library","sap/ui/core/IconPool"],function(e,t,i,o,n){"use strict";const s=i.createWeakMapFacade();const l=e.extend("sap.ui.table.plugins.ODataV4MultiSelection",{metadata:{library:"sap.ui.table",properties:{limit:{type:"int",group:"Behavior",defaultValue:200},enableNotification:{type:"boolean",group:"Behavior",defaultValue:false},hideHeaderSelector:{type:"boolean",group:"Appearance",defaultValue:false}}}});l.findOn=t.findOn;l.prototype.init=function(){e.prototype.init.apply(this,arguments);s(this).bLimitReached=false;s(this).oRangeSelectionStartContext=null};l.prototype.onActivate=function(t){const n=t.getBinding();e.prototype.onActivate.apply(this,arguments);t.setProperty("selectionMode",o.SelectionMode.MultiToggle);if(n){f(this,n)}else{c(this)}i.Hook.register(t,i.Hook.Keys.Table.RowsBound,h,this);i.Hook.register(t,i.Hook.Keys.Table.TotalRowCountChanged,u,this);i.Hook.register(t,i.Hook.Keys.Table.UpdateRows,S,this);i.Hook.register(t,i.Hook.Keys.Table.UnbindRows,S,this)};l.prototype.onDeactivate=function(t){e.prototype.onDeactivate.apply(this,arguments);t.setProperty("selectionMode",o.SelectionMode.None);s(this).bLimitReached=false;s(this).oRangeSelectionStartContext=null;p(this,t.getBinding());i.Hook.deregister(t,i.Hook.Keys.Table.RowsBound,h,this);i.Hook.deregister(t,i.Hook.Keys.Table.TotalRowCountChanged,u,this);i.Hook.deregister(t,i.Hook.Keys.Table.UpdateRows,S,this);i.Hook.register(t,i.Hook.Keys.Table.UnbindRows,S,this);S.call(this)};l.prototype.setSelected=function(e,t,o){const n=i.getBindingContextOfRow(e);if(!this.isActive()||!n||!this.isContextSelectable(n)){return}if(o?.range){r(this,e);return}if(this.isSelected(e)===t){return}n.setSelected(t);s(this).oRangeSelectionStartContext=t?n:null};function r(e,t){if(!s(e).oRangeSelectionStartContext){return}let o=s(e).oRangeSelectionStartContext.getIndex();const n=i.getBindingContextOfRow(t);const l=n?n.getIndex():-1;if(o!==l){o+=l>o?1:-1}C(e,o,l)}function a(e){const t=e.getControl().getBinding();let i=-1;if(!t||t.getLength()===0){return 0}if(t.getAggregation()){if(e._isLimitDisabled()){const o=t.getAllCurrentContexts();if(t.getLength()===o.length){i=o.filter(t=>e.isContextSelectable(t)).length}}}else if(t.isLengthFinal()){i=t.getLength()}return i}function c(e){const t=e._getHeaderSelector();if(!e.isActive()||!t){return}const o=e._isLimitDisabled()?"CheckBox":"Icon";const s=a(e);const l=e.getSelectedCount();const r=d(s,l);let c=null;let g="";if(o==="Icon"){c=l===0?i.getResourceText("TBL_SELECT_ALL"):i.getResourceText("TBL_DESELECT_ALL")}if(r){g=n.getIconURI(i.ThemeParameters.allSelectedIcon)}else if(l>0){g=n.getIconURI(i.ThemeParameters.clearSelectionIcon)}else{g=n.getIconURI(i.ThemeParameters.checkboxIcon)}t.setVisible(!e.getHideHeaderSelector());t.setEnabled(s!==0);t.setType(o);t.setCheckBoxSelected(r);t.setTooltip(c);t.setIcon(g)}function g(e){if(d(a(e),e.getSelectedCount())){e.clearSelection();return false}else if(e._isLimitDisabled()){const t=e.getControl().getBinding();if(t?.getLength()){C(e,0,t.getLength()-1);return true}}return undefined}function d(e,t){return e>0&&e===t}l.prototype.onHeaderSelectorPress=function(){e.prototype.onHeaderSelectorPress.apply(this,arguments);const t=this._getHeaderSelector();if(!t.getVisible()||!t.getEnabled()){return}if(t.getType()==="CheckBox"){g(this)}else if(t.getType()==="Icon"){if(this.getSelectedCount()>0){this.clearSelection()}else{const e=this.getControl().getBinding();if(e?.getLength()>0){C(this,0,e.getLength()-1)}}}};l.prototype.onKeyboardShortcut=function(t,i){e.prototype.onKeyboardShortcut.apply(this,arguments);if(!this.isActive()){return}if(t==="toggle"){if(this._isLimitDisabled()){if(g(this)===false){i.setMarked("sapUiTableClearAll")}}else{const e=this.getControl().getBinding();if(e?.getLength()>0){C(this,0,e.getLength()-1)}}}};l.prototype.setLimit=function(e){this.setProperty("limit",e,true);s(this).bLimitReached=false;c(this);return this};function h(e){f(this,e)}function u(){c(this)}function f(e,t){const i=t.getModel().bindProperty("$selectionCount",t.getHeaderContext());i.attachChange(()=>{c(e)});i.initialize();s(e).oSelectionCountBinding=i;t?.attachEvent("selectionChanged",S,e)}function p(e,t){s(e).oSelectionCountBinding?.destroy();delete s(e).oSelectionCountBinding;t?.detachEvent("selectionChanged",S,e)}function S(){delete s(this).aSelectedContexts}l.prototype._isLimitDisabled=function(){return this.getLimit()===0};l.prototype.setHideHeaderSelector=function(e){this.setProperty("hideHeaderSelector",e,true);this._getHeaderSelector()?.setVisible(!e);return this};function C(e,t,o){const n=e.getControl();const l=e.getLimit();const r=o<t;let a=r?o:t;let c=Math.abs(o-t)+1;if(!e._isLimitDisabled()){s(e).bLimitReached=c>l;if(s(e).bLimitReached){if(r){o=t-l+1;a=o}else{o=t+l-1}c=l+1}}i.loadContexts(n.getBinding(),a,c).then(function(t){t.forEach(function(t){if(!e.isContextSelectable(t)||t.isSelected()){return}if(r&&t.getIndex()>=o||t.getIndex()<=o){t.setSelected(true)}if(t.getIndex()===o){s(e).oRangeSelectionStartContext=t}});if(s(e).bLimitReached){i.scrollTableToIndex(n,o,r).then(function(){if(e.getEnableNotification()){i.showNotificationPopoverAtIndex(n,o,e.getLimit())}})}})}l.prototype.getSelectedContexts=function(){if(!this.isActive()){return[]}s(this).aSelectedContexts??=this.getControl().getBinding()?.getAllCurrentContexts().filter(e=>e.isSelected())??[];return s(this).aSelectedContexts};l.prototype.onThemeChanged=function(){c(this)};return l});
//# sourceMappingURL=ODataV4MultiSelection.js.map