/*
 * SAPUI5
 * (c) Copyright 2025 SAP SE. All rights reserved.
 */
sap.ui.define([],function(){"use strict";var e;var t=function(){if(!e){e=this;this.mRequests=new Map;this._iMaxRequests=1e3;if(window.location.search.indexOf("data-sap-ui-xx-disableTextArrangementReadCache=true")!==-1){this.read=function(e,t,r){return this._createReadPromise({model:e,path:t,settings:r})}.bind(this)}}return e};t.prototype.read=function(e,t,r){var s,i={model:e,path:t,settings:r};try{s=this._calculateCacheKey(i)}catch(e){return this._createReadPromise(i)}return this._getPromise(s,i)};t.prototype._getPromise=function(e,t){var r,s;if(this.mRequests.has(e)){r=this.mRequests.get(e);s=this._validateCache(e,r,t);if(s===true){return r.promise}if(s instanceof Promise){return s}}return this._createReadPromise(t,e)};t.prototype._setPromise=function(e,t,r){var s;this.mRequests.set(e,{modelId:r.model.getId(),promise:t});if(this.mRequests.size>this._iMaxRequests){s=this.mRequests.getKeys().next().value;if(s){this.mRequests.delete(s)}}};t.prototype._validateCache=function(e,t,r){if(r&&r.model){if(t.modelId===r.model.getId()){return true}return new Promise(function(s){t.promise.then(function(i){if(i&&Array.isArray(i.results)&&this._probeLocalModelForLoadedData(r,i)){s(t.promise)}else{s(this._createReadPromise(r,e))}}.bind(this))}.bind(this))}return true};t.prototype._probeLocalModelForLoadedData=function(e,t){var r=e.model.getKey(t.results[0]);if(r){return!!e.model.getProperty("/"+r)}return false};t.prototype.exit=function(){this.mRequests.clear()};t.prototype.clearCache=function(){this.mRequests.clear()};t.prototype._createReadPromise=function(e,t){var r=new Promise(function(t,r){e.settings.success=t;e.settings.error=r;e.model.read(e.path,e.settings)}).then(function(e){var r=e&&Array.isArray(e.results)&&e.results.length===1;if(t&&!r){this.mRequests.delete(t)}return e}.bind(this));if(t){this._setPromise(t,r,e)}return r};t.prototype._calculateCacheKey=function(e){var t,r=e.model.sServiceUrl,s=e.model.aUrlParams;if(!r){throw"Can't access service URL. Opt out of value list caching."}r=new URL(r,document.baseURI).pathname;t={path:e.path,service:r,filters:this._flattenFilters(e.settings.filters)};if(Array.isArray(s)&&s.length){t["urlParams"]=s}return JSON.stringify(t)};t.prototype._flattenFilters=function(e){var t=[],r=function(e){if(e.sPath){t.push({p:e.sPath,v:e.oValue1})}if(Array.isArray(e.aFilters)){e.aFilters.forEach(r)}};r(e[0]);return t};return t},false);
//# sourceMappingURL=TextArrangementRead.js.map