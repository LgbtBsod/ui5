<mvc:View
    controllerName="sap_ui5.controller.Search"
    xmlns="sap.m"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns:core="sap.ui.core"
    xmlns:smartFilterBar="sap.ui.comp.smartfilterbar"
    xmlns:smartTable="sap.ui.comp.smarttable">

    <Page
        showHeader="false"
        class="pageTransparent"
        busy="{state>/isLoading}">

        <content>
            <VBox class="appContent sapUiSmallMargin">

                <VBox class="glassCard filterCard smartFilterGlass sapUiSmallMarginBottom">
                    <Toolbar class="toolbarTransparent">
                        <Title text="{i18n>filtersTitle}"/>
                    </Toolbar>

                    <smartFilterBar:SmartFilterBar
                        id="searchSmartFilterBar"
                        entitySet="CheckListSet"
                        persistencyKey="pcctSmartFilter"
                        useToolbar="true"
                        search=".onSmartSearch"
                        filterChange=".onSmartFilterChanged">

                        <smartFilterBar:controlConfiguration>
                            <smartFilterBar:ControlConfiguration key="maxResults" label="{i18n>searchMaxResultsLabel}" visibleInAdvancedArea="true">
                                <smartFilterBar:customControl>
                                    <Input value="{state>/searchMaxResults}" width="10rem" type="Number"/>
                                </smartFilterBar:customControl>
                            </smartFilterBar:ControlConfiguration>

                            <smartFilterBar:ControlConfiguration key="has_failed_checks" label="{i18n>filterChecksLabel}" visibleInAdvancedArea="true">
                                <smartFilterBar:customControl>
                                    <HBox class="statusToggleWrapper" renderType="Bare">
                                        <Button text="{i18n>allChecks}" press=".onStatusFilterPress" class="customStatusBtn btnAll btnSegStart {= ${state>/filterFailedChecks} === 'ALL' ? 'activeStatus' : '' }">
                                            <customData>
                                                <core:CustomData key="filterPath" value="/filterFailedChecks"/>
                                                <core:CustomData key="filterValue" value="ALL"/>
                                            </customData>
                                        </Button>
                                        <Button text="{i18n>hasFailed}" press=".onStatusFilterPress" class="customStatusBtn btnFailed btnSegMiddle {= ${state>/filterFailedChecks} === 'TRUE' ? 'activeStatus' : '' }">
                                            <customData>
                                                <core:CustomData key="filterPath" value="/filterFailedChecks"/>
                                                <core:CustomData key="filterValue" value="TRUE"/>
                                            </customData>
                                        </Button>
                                        <Button text="{i18n>allPassed}" press=".onStatusFilterPress" class="customStatusBtn btnPassed btnSegEnd {= ${state>/filterFailedChecks} === 'FALSE' ? 'activeStatus' : '' }">
                                            <customData>
                                                <core:CustomData key="filterPath" value="/filterFailedChecks"/>
                                                <core:CustomData key="filterValue" value="FALSE"/>
                                            </customData>
                                        </Button>
                                    </HBox>
                                </smartFilterBar:customControl>
                            </smartFilterBar:ControlConfiguration>

                            <smartFilterBar:ControlConfiguration key="has_failed_barriers" label="{i18n>filterBarriersLabel}" visibleInAdvancedArea="true">
                                <smartFilterBar:customControl>
                                    <HBox class="statusToggleWrapper" renderType="Bare">
                                        <Button text="{i18n>allBarriers}" press=".onStatusFilterPress" class="customStatusBtn btnAll btnSegStart {= ${state>/filterFailedBarriers} === 'ALL' ? 'activeStatus' : '' }">
                                            <customData>
                                                <core:CustomData key="filterPath" value="/filterFailedBarriers"/>
                                                <core:CustomData key="filterValue" value="ALL"/>
                                            </customData>
                                        </Button>
                                        <Button text="{i18n>hasFailed}" press=".onStatusFilterPress" class="customStatusBtn btnFailed btnSegMiddle {= ${state>/filterFailedBarriers} === 'TRUE' ? 'activeStatus' : '' }">
                                            <customData>
                                                <core:CustomData key="filterPath" value="/filterFailedBarriers"/>
                                                <core:CustomData key="filterValue" value="TRUE"/>
                                            </customData>
                                        </Button>
                                        <Button text="{i18n>allPassed}" press=".onStatusFilterPress" class="customStatusBtn btnPassed btnSegEnd {= ${state>/filterFailedBarriers} === 'FALSE' ? 'activeStatus' : '' }">
                                            <customData>
                                                <core:CustomData key="filterPath" value="/filterFailedBarriers"/>
                                                <core:CustomData key="filterValue" value="FALSE"/>
                                            </customData>
                                        </Button>
                                    </HBox>
                                </smartFilterBar:customControl>
                            </smartFilterBar:ControlConfiguration>
                        </smartFilterBar:controlConfiguration>
                    </smartFilterBar:SmartFilterBar>
                </VBox>

                <VBox class="glassCard smartTableGlass">
                    <Toolbar class="toolbarTransparent tableActionToolbar searchToolbar sapUiTinyMarginBottom">
                        <Button text="{i18n>createButton}" press=".onCreate" class="sapUiTinyMarginEnd"/>
                        <Button text="{i18n>copyButton}" press=".onCopy" class="sapUiTinyMarginEnd"/>
                        <Button text="{i18n>deleteButton}" type="Reject" press=".onDelete" enabled="{view>/hasSelection}" class="sapUiTinyMarginEnd"/>
                        <Button text="{i18n>exportChecklistButton}" press=".onExportReport" type="Transparent" class="sapUiTinyMarginEnd">
                            <customData><core:CustomData key="entity" value="checklist"/></customData>
                        </Button>
                        <Button text="{i18n>exportBarriersButton}" press=".onExportReport" type="Transparent" class="sapUiTinyMarginEnd">
                            <customData><core:CustomData key="entity" value="barrier"/></customData>
                        </Button>
                        <Button text="{i18n>exportChecksButton}" press=".onExportReport" type="Transparent" class="sapUiTinyMarginEnd">
                            <customData><core:CustomData key="entity" value="check"/></customData>
                        </Button>
                        <ToolbarSpacer/>
                        <Label text="{i18n>searchModeLabel}" class="sapUiTinyMarginEnd"/>
                        <Switch state="{= ${state>/searchMode} === 'LOOSE' }" change=".onSearchModeToggle" customTextOn="" customTextOff="" class="accentSwitch"/>
                    </Toolbar>

                    <smartTable:SmartTable
                        id="searchSmartTable"
                        entitySet="CheckListSet"
                        smartFilterId="searchSmartFilterBar"
                        tableType="ResponsiveTable"
                        useVariantManagement="true"
                        useTablePersonalisation="true"
                        showRowCount="true"
                        header="{i18n>resultsLabel}"
                        persistencyKey="pcctSmartTable"
                        enableAutoBinding="true"
                        beforeRebindTable=".onBeforeSmartTableRebind"
                        initialise=".onSmartTableInitialise"
                        initiallyVisibleFields="id,status,LPC_TEXT,PROF_TEXT,date,time,OBSERVER_FULLNAME,OBSERVED_FULLNAME"
                        requestAtLeastFields="id,status,LPC_KEY,has_failed_checks,has_failed_barriers"/>
                </VBox>

            </VBox>
        </content>
    </Page>
</mvc:View>
