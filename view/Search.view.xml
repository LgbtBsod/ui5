<mvc:View
    controllerName="sap_ui5.controller.Search"
    xmlns="sap.m"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns:core="sap.ui.core">

    <Page
        title="{i18n>searchPageTitle}"
        class="pageTransparent"
        busy="{state>/isLoading}">

        <content>
            <VBox class="appContent sapUiSmallMargin">

                <VBox class="glassCard filterCard sapUiSmallMarginBottom">
                    <Toolbar class="toolbarTransparent">
                        <Title text="{i18n>filtersTitle}"/>
                    </Toolbar>


                    <HBox class="uxStatRow" wrap="Wrap" renderType="Bare">
                        <ObjectStatus text="Custom SmartFilter" state="Success" visible="{layout>/smartFilter/useCustomSmartFilters}" class="sapUiTinyMarginEnd"/>
                        <ObjectStatus text="Custom SmartTable" state="Success" visible="{layout>/smartTable/useCustomSmartTable}"/>
                    </HBox>
                    <MessageStrip
                        visible="{state>/loadError}"
                        type="Error"
                        showIcon="true"
                        text="{= ${state>/loadErrorMessage} || ${i18n>loadErrorMessage} }"
                        class="sapUiTinyMarginTop"/>

                    <HBox class="sapUiSmallMarginTop filterWrap" alignItems="Center" wrap="Wrap" renderType="Bare">
                        <Input
                            placeholder="{i18n>checklistIdPlaceholder}"
                            value="{state>/filterId}"
                            width="14rem"
                            class="sapUiTinyMarginEnd sapUiTinyMarginBottom"/>

                        <Select
                            width="14rem"
                            selectedKey="{state>/filterLpc}"
                            class="sapUiTinyMarginEnd sapUiTinyMarginBottom">
                            <items>
                                <core:Item key="" text="{i18n>allLpc}"/>
                                <core:Item key="L1" text="{i18n>lpcLow}"/>
                                <core:Item key="L2" text="{i18n>lpcMedium}"/>
                                <core:Item key="L3" text="{i18n>lpcHigh}"/>
                            </items>
                        </Select>

                        <SegmentedButton selectedKey="{state>/filterFailedChecks}" class="statusSegment cleanSegment sapUiTinyMarginEnd sapUiTinyMarginBottom" selectionChange=".onSearch">
                            <items>
                                <SegmentedButtonItem key="ALL" text="{i18n>allChecks}"/>
                                <SegmentedButtonItem key="TRUE" text="{i18n>hasFailed}"/>
                                <SegmentedButtonItem key="FALSE" text="{i18n>allPassed}"/>
                            </items>
                        </SegmentedButton>

                        <SegmentedButton selectedKey="{state>/filterFailedBarriers}" class="statusSegment cleanSegment sapUiTinyMarginEnd sapUiTinyMarginBottom" selectionChange=".onSearch">
                            <items>
                                <SegmentedButtonItem key="ALL" text="{i18n>allBarriers}"/>
                                <SegmentedButtonItem key="TRUE" text="{i18n>hasFailed}"/>
                                <SegmentedButtonItem key="FALSE" text="{i18n>allPassed}"/>
                            </items>
                        </SegmentedButton>

                        <Button text="{i18n>searchButton}" type="Emphasized" press=".onSearch" class="sapUiTinyMarginEnd sapUiTinyMarginBottom"/>
                        <Button text="{i18n>resetButton}" visible="{view>/hasActiveFilters}" press=".onResetFilters" class="sapUiTinyMarginBottom"/>
                    </HBox>
                </VBox>

                <VBox class="glassCard">
                    <Toolbar class="toolbarTransparent tableActionToolbar searchToolbar sapUiTinyMarginBottom">
                        <Button text="{i18n>createButton}" press=".onCreate" class="sapUiTinyMarginEnd"/>
                        <Button text="{i18n>copyButton}" press=".onCopy" class="sapUiTinyMarginEnd"/>
                        <Button text="{i18n>deleteButton}" type="Reject" press=".onDelete" enabled="{view>/hasSelection}"/>
                        <ToolbarSpacer/>
                        <Label text="{i18n>searchModeLabel}" class="sapUiTinyMarginEnd"/>
                        <Text text="{i18n>searchModeExact}" class="sapUiTinyMarginEnd modeHintText" visible="{= ${state>/searchMode} !== 'LOOSE' }"/>
                        <Text text="{i18n>searchModeLoose}" class="sapUiTinyMarginEnd modeHintText" visible="{= ${state>/searchMode} === 'LOOSE' }"/>
                        <Switch state="{= ${state>/searchMode} === 'LOOSE' }" change=".onSearchModeToggle" customTextOn="" customTextOff=""/>
                    </Toolbar>


                    <HBox class="uxStatRow" wrap="Wrap" renderType="Bare">
                        <HBox class="uxStatChip" renderType="Bare">
                            <Text text="{i18n>searchModeLabel}" class="sapUiTinyMarginEnd"/>
                            <Text text="{= ${state>/searchMode} === 'LOOSE' ? ${i18n>searchModeLoose} : ${i18n>searchModeExact} }"/>
                        </HBox>
                        <HBox class="uxStatChip" renderType="Bare">
                            <Text text="{i18n>resultsLabel}" class="sapUiTinyMarginEnd"/>
                            <Text text="{view>/resultSummary}"/>
                        </HBox>
                        <HBox class="uxStatChip" renderType="Bare" visible="{view>/hasActiveFilters}">
                            <Text text="{i18n>activeFilters}"/>
                        </HBox>
                    </HBox>
                    <Toolbar class="toolbarTransparent sapUiTinyMarginBottom resultToolbar">
                        <Title level="H5" text="{i18n>resultsLabel}"/>
                        <ToolbarSpacer/>
                        <ObjectStatus text="{view>/resultSummary}" state="Information"/>
                    </Toolbar>

                    <Table
                        id="checkTable"
                        growing="true"
                        growingThreshold="20"
                        class="glassTable roundedTable searchResultTable"
                        busy="{state>/isLoading}"
                        noDataText="{= ${state>/loadError} ? ${i18n>noDataLoadError} : ${i18n>noDataDefault} }"
                        items="{ path: 'data>/visibleCheckLists' }"
                        mode="SingleSelectMaster"
                        itemPress=".onSelect">

                        <columns>
                            <Column><Text text="{i18n>columnId}"/></Column>
                            <Column><Text text="{i18n>columnStatus}"/></Column>
                            <Column><Text text="{i18n>columnChecks}"/></Column>
                            <Column><Text text="{i18n>columnBarriers}"/></Column>
                            <Column><Text text="{i18n>columnObserver}"/></Column>
                        </columns>

                        <items>
                            <ColumnListItem type="Navigation" class="searchResultRow">
                                <cells>
                                    <Text text="{data>root/id}"/>
                                    <ObjectStatus
                                        text="{data>root/status}"
                                        state="{ path: 'data>root/status', formatter: '.formatStatus' }"/>
                                    <ProgressIndicator percentValue="{data>root/successRateChecks}" displayValue="{= ${data>root/successRateChecks} + '%' }" state="Information"/>
                                    <ProgressIndicator percentValue="{data>root/successRateBarriers}" displayValue="{= ${data>root/successRateBarriers} + '%' }" state="Information"/>
                                    <Text text="{data>basic/OBSERVER_FULLNAME}"/>
                                </cells>
                            </ColumnListItem>
                        </items>
                    </Table>
                </VBox>

            </VBox>
        </content>
    </Page>
</mvc:View>
