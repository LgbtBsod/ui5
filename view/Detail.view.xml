<mvc:View
    controllerName="sap_ui5.controller.Detail"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns="sap.m"
    xmlns:form="sap.ui.layout.form"
    xmlns:f="sap.f"
    xmlns:dnd="sap.ui.core.dnd"
    xmlns:core="sap.ui.core">

    <Page showHeader="false" class="pageTransparent">

        <VBox class="appContent detailContent">

            <MessageStrip
                text="{i18n>lockKilledMessage}"
                type="Warning"
                showIcon="true"
                visible="{state>/isKilled}"
                class="sapUiTinyMarginBottom"/>

            <VBox class="glassCard detailHeroCard">
                <HBox justifyContent="SpaceBetween" alignItems="Center" wrap="Wrap" class="detailHeroHeader" renderType="Bare">
                    <VBox renderType="Bare" class="sapUiTinyMarginEnd">
                        <Title text="{i18n>detailPageTitle}" class="detailHeroTitle"/>
                        <Text text="{i18n>detailHeroSubtitle}" class="modeHintText"/>
                    </VBox>
                    <HBox class="uxStatRow" wrap="Wrap" renderType="Bare">
                        <HBox class="uxStatChip" renderType="Bare">
                            <Text text="{i18n>checklistLabel}" class="sapUiTinyMarginEnd"/>
                            <Text text="{= ${selected>/root/id} || ${i18n>newChecklist} }"/>
                        </HBox>
                        <HBox class="uxStatChip" renderType="Bare">
                            <Text text="{i18n>editMode}" class="sapUiTinyMarginEnd"/>
                            <Text text="{= ${state>/mode} === 'EDIT' ? ${i18n>modeEdit} : ${i18n>modeRead} }"/>
                        </HBox>
                        <HBox class="uxStatChip" renderType="Bare" visible="{= !!${state>/lockExpires} }">
                            <Text text="{i18n>lockExpiresLabel}" class="sapUiTinyMarginEnd"/>
                            <Text text="{state>/lockExpires}"/>
                        </HBox>
                    </HBox>
                </HBox>
            </VBox>

            <HBox justifyContent="End" class="sapUiTinyMarginBottom" alignItems="Center" renderType="Bare">
                <Button
                    text="{i18n>objectSave}"
                    type="Emphasized"
                    visible="{= ${state>/mode} === 'EDIT' }"
                    press=".onSaveDetail"
                    class="sapUiTinyMarginEnd accentButton"/>
                <Button
                    text="{i18n>objectCancel}"
                    visible="{= ${state>/mode} === 'EDIT' }"
                    press=".onCancelEditFromDetail"
                    class="sapUiTinyMarginEnd"/>
                <Label text="{i18n>editMode}" class="sapUiTinyMarginEnd"/>
                <HBox alignItems="Center" renderType="Bare" class="lockSwitchWrap sapUiTinyMarginEnd">
                    <BusyIndicator visible="{state>/lockOperationPending}" size="1rem" class="sapUiTinyMarginEnd"/>
                    <Switch
                        state="{= ${state>/mode} === 'EDIT' }"
                        enabled="{= !${state>/lockOperationPending} }"
                        change=".onToggleEditFromDetail"
                        class="accentSwitch"/>
                    <ObjectStatus text="{state>/lockOperationText}" state="{= ${state>/lockOperationState} === 'SUCCESS' ? 'Success' : ${state>/lockOperationState} === 'ERROR' ? 'Error' : 'Information' }" class="sapUiTinyMarginBegin"/>
                </HBox>
                <Button
                    icon="sap-icon://decline"
                    type="Transparent"
                    tooltip="{i18n>closeDetails}"
                    press=".onCloseDetail"/>
            </HBox>

            <VBox class="glassCard">
                <Toolbar class="toolbarTransparent">
                    <Title text="{i18n>participantsTitle}"/>
                    <ToolbarSpacer/>
                    <Text text="{i18n>dragHint}" visible="{= ${state>/mode} === 'EDIT' }" class="modeHintText"/>
                </Toolbar>
                <f:GridList id="infoCardGrid" items="{view>/infoCards}" class="infoCardGrid">
                    <f:dragDropConfig>
                        <dnd:DragInfo sourceAggregation="items" enabled="{= ${state>/mode} === 'EDIT' }"/>
                        <dnd:DropInfo targetAggregation="items" dropPosition="Between" enabled="{= ${state>/mode} === 'EDIT' }" drop=".onInfoCardsDrop"/>
                    </f:dragDropConfig>
                    <f:items>
                        <f:GridListItem>
                            <VBox class="infoCardTile" renderType="Bare">
                                <Text text="{view>title}" class="infoCardTitle"/>
                                <Text
                                    text="{parts: [
                                        {path: 'view>key'},
                                        {path: 'selected>/basic/OBSERVER_FULLNAME'},
                                        {path: 'selected>/basic/OBSERVED_FULLNAME'},
                                        {path: 'selected>/basic/LOCATION_NAME'},
                                        {path: 'selected>/basic/LOCATION_TEXT'}
                                    ], formatter: '.formatInfoCardValue'}"
                                    class="infoCardValue"/>
                            </VBox>
                        </f:GridListItem>
                    </f:items>
                </f:GridList>
            </VBox>

            <VBox class="glassCard">
                <Title text="{i18n>basicInformation}"/>
                <form:SimpleForm
                    editable="true"
                    layout="ResponsiveGridLayout"
                    columnsL="2"
                    columnsM="2">

                    <Label text="{i18n>dateLabel}"/>
                    <Input value="{selected>/basic/date}" editable="{= ${state>/mode} === 'EDIT' }"/>

                    <Label text="{i18n>equipmentLabel}"/>
                    <Input value="{selected>/basic/equipment}" editable="{= ${state>/mode} === 'EDIT' }"/>

                    <Label text="{i18n>observerLabel}"/>
                    <Input value="{selected>/basic/OBSERVER_FULLNAME}"
                           editable="{= ${state>/mode} === 'EDIT' }"
                           showSuggestion="true"
                           suggest=".onPersonSuggest"
                           suggestionItemSelected=".onPersonSuggestionSelected">
                        <customData>
                            <core:CustomData key="target" value="observer" writeToDom="false"/>
                        </customData>
                        <suggestionItems path="view>/observerSuggestions">
                            <core:Item key="{view>perner}" text="{parts:[{path:'view>fullName'},{path:'view>position'}], formatter:'.formatPersonSuggestion'}"/>
                        </suggestionItems>
                    </Input>

                    <Label text="{i18n>observedLabel}"/>
                    <Input value="{selected>/basic/OBSERVED_FULLNAME}"
                           editable="{= ${state>/mode} === 'EDIT' }"
                           showSuggestion="true"
                           suggest=".onPersonSuggest"
                           suggestionItemSelected=".onPersonSuggestionSelected">
                        <customData>
                            <core:CustomData key="target" value="observed" writeToDom="false"/>
                        </customData>
                        <suggestionItems path="view>/observedSuggestions">
                            <core:Item key="{view>perner}" text="{parts:[{path:'view>fullName'},{path:'view>position'}], formatter:'.formatPersonSuggestion'}"/>
                        </suggestionItems>
                    </Input>

                    <Label text="{i18n>lpcLabel}"/>
                    <Input value="{selected>/basic/LPC_TEXT}" editable="{= ${state>/mode} === 'EDIT' }"/>

                </form:SimpleForm>
            </VBox>

            <VBox class="glassCard">
                <Toolbar class="toolbarTransparent">
                    <Title text="{i18n>locationLabel}"/>
                </Toolbar>
                <Text text="{selected>/basic/LOCATION_NAME}" class="sapUiTinyMarginBottom"/>
                <Tree
                    items="{path: 'view>/locationTree', parameters: { arrayNames: ['children'] }}"
                    mode="{= ${state>/mode} === 'EDIT' ? 'SingleSelectMaster' : 'None' }"
                    includeItemInSelection="true"
                    selectionChange=".onLocationSelectionChange"
                    visible="true">
                    <StandardTreeItem title="{view>location_name}"/>
                </Tree>
            </VBox>

            <VBox class="glassCard">
                <Toolbar class="toolbarTransparent">
                    <Title text="{i18n>checksTitle}"/>
                    <ToolbarSpacer/>
                    <Button
                        text="{i18n>addRow}"
                        press=".onAddCheckRow"
                        visible="{= ${state>/mode} === 'EDIT' }"/>
                </Toolbar>
                <Table items="{selected>/checks}" class="flatEditorTable" busy="{view>/checksLoading}">
                    <columns>
                        <Column width="3rem"><Text text=""/></Column>
                        <Column><Text text="{i18n>checkLabel}"/></Column>
                        <Column><Text text="{i18n>statusLabel}"/></Column>
                        <Column width="2.5rem" visible="{= ${state>/mode} === 'EDIT' }"><Text text=""/></Column>
                    </columns>
                    <items>
                        <ColumnListItem>
                            <cells>
                                <CheckBox selected="{selected>selected}" select=".onSelectionToggle" visible="{= ${state>/mode} === 'EDIT' }"/>
                                <Input value="{selected>text}" editable="{= ${state>/mode} === 'EDIT' }"/>
                                <Switch state="{selected>result}" enabled="{= ${state>/mode} === 'EDIT' }"/>
                                <Button icon="sap-icon://delete" type="Transparent" press=".onDeleteCheckRow" visible="{= ${state>/mode} === 'EDIT' }"/>
                            </cells>
                        </ColumnListItem>
                    </items>
                </Table>
            </VBox>

            <VBox class="glassCard">
                <Toolbar class="toolbarTransparent">
                    <Title text="{i18n>barriersTitle}"/>
                    <ToolbarSpacer/>
                    <Button
                        text="{i18n>addRow}"
                        press=".onAddBarrierRow"
                        visible="{= ${state>/mode} === 'EDIT' }"/>
                </Toolbar>
                <Table items="{selected>/barriers}" class="flatEditorTable" busy="{view>/barriersLoading}">
                    <columns>
                        <Column width="3rem"><Text text=""/></Column>
                        <Column><Text text="{i18n>barrierLabel}"/></Column>
                        <Column><Text text="{i18n>statusLabel}"/></Column>
                        <Column width="2.5rem" visible="{= ${state>/mode} === 'EDIT' }"><Text text=""/></Column>
                    </columns>
                    <items>
                        <ColumnListItem>
                            <cells>
                                <CheckBox selected="{selected>selected}" select=".onSelectionToggle" visible="{= ${state>/mode} === 'EDIT' }"/>
                                <Input value="{selected>text}" editable="{= ${state>/mode} === 'EDIT' }"/>
                                <Switch state="{selected>result}" enabled="{= ${state>/mode} === 'EDIT' }"/>
                                <Button icon="sap-icon://delete" type="Transparent" press=".onDeleteBarrierRow" visible="{= ${state>/mode} === 'EDIT' }"/>
                            </cells>
                        </ColumnListItem>
                    </items>
                </Table>
            </VBox>

        </VBox>

    </Page>
</mvc:View>
